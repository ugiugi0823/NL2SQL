# LLM 기반 스키마/SQL 생성 프롬프팅 실험 보고서

## 1. 스키마 생성 프롬프트 시도 및 개선

### 1차 시도 (개선 전 프롬프트)
```
도메인: 영화 정보
설명: 영화 제목, 감독, 배우, 장르, 개봉일 등 영화 관련 정보를 관리
아래 조건을 만족하는 테이블 스키마(JSON) 예시를 생성하세요.
- 공통 컬럼: id, created_at, updated_at
- 제약조건: id는 PK, created_at/updated_at은 DATETIME, NOT NULL
- 일관된 JSON 포맷으로 출력
```
- **문제:** 설명 텍스트, 마크다운 코드블록(```json ... ````) 포함 → 파싱 오류, 필드 개수/구조 불일치, comment 누락

### 2차 개선 (개선 후 프롬프트)
```
도메인: 영화 정보
설명: 영화 제목, 감독, 배우, 장르, 개봉일 등 영화 관련 정보를 관리
아래 조건을 모두 만족하는 테이블 스키마(JSON) 예시를 생성하세요.
- id, created_at, updated_at을 포함해 총 20개의 필드로 구성
- 각 필드는 type(데이터 타입)과 comment(설명)를 반드시 포함
- 예시 포맷:
{
  "id": {"type": "INTEGER", "comment": "기본키"},
  "created_at": {"type": "DATETIME", "comment": "생성일시"},
  "updated_at": {"type": "DATETIME", "comment": "수정일시"},
  "field4": {"type": "VARCHAR(100)", "comment": "설명"},
  ... (총 20개 필드)
}
- 설명 없이 JSON만 반환하세요. 코드블록도 사용하지 마세요.
```
- **결과:** 스키마 파싱 오류/구조 불일치 문제 해결, 일관된 JSON 스키마 확보

---

## 2. SQL 생성 프롬프트 시도 및 개선

### 1차 시도 (개선 전 프롬프트)
```
도메인: 영화 정보
설명: 영화 제목, 감독, 배우, 장르, 개봉일 등 영화 관련 정보를 관리
테이블 스키마(JSON): { ...스키마 JSON... }
난이도: Basic
자연어 질의: "톰 행크스가 출연한 코미디 영화는 무엇인가요?"
위 정보를 바탕으로 SQL 쿼리를 생성하세요.
쿼리만 출력하세요.
```
- **문제:** LLM이 SQL을 ```sql ... ``` 코드블록으로 반환 → SQLite 파싱 오류, 테이블명/컬럼명 불일치, 설명 텍스트 포함

### 2차 개선 (개선 후 프롬프트)
```
도메인: 영화 정보
설명: 영화 제목, 감독, 배우, 장르, 개봉일 등 영화 관련 정보를 관리
테이블 스키마(JSON): { ...스키마 JSON... }
난이도: Basic
자연어 질의: "톰 행크스가 출연한 코미디 영화는 무엇인가요?"
위 정보를 바탕으로 SQL 쿼리를 생성하세요.
- 반드시 sample 테이블만 사용하세요.
- 컬럼명과 타입은 스키마와 정확히 일치해야 합니다.
- 설명 없이, 코드블록 없이, SQL 쿼리문만 반환하세요.
- 예시: SELECT ... FROM sample WHERE ...;
```
- **결과:** 코드블록 파싱 오류 완전 해결, SQL 실행 성공률 대폭 상승(0% → 50~90%)

---

## 3. 실패 유형별 개선 요약

- 코드블록/설명 포함 → "설명 없이, 코드블록 없이" 명확히 요구 + 후처리로 내부만 추출
- 스키마/SQL 구조 불일치 → "컬럼명/타입은 스키마와 정확히 일치" 명확히 요구
- 테이블명 불일치 → "반드시 sample 테이블만 사용" 명확히 요구
- 파싱/실행 오류 → 자동 검증 및 오류 유형별 프롬프트/후처리 보강

---

## 4. 결론 및 교훈

- LLM 프롬프트는 구체적이고 엄격하게 작성해야 하며, "설명 없이, 코드블록 없이, 쿼리문만"을 명확히 요구해야 함
- 후처리(코드블록 추출 등)와 자동 검증을 반드시 병행해야 실질적 자동화가 가능
- 실패 유형을 빠르게 분석하고, 프롬프트/후처리를 반복적으로 개선하는 것이 성공률 향상의 핵심

---

## 5. 최신 실험 결과 (성공률)

- 대부분의 도메인에서 SQL 성공률 50% 이상 달성
- 영화 정보, 음악 스트리밍, 항공권 예약, 날씨 정보 등은 70~90% 성공률
- 프롬프트/후처리 개선이 실질적 성능 향상에 결정적 역할 